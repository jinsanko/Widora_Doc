<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>Widora_How_To_用Eclipse开发OpenWrt_C_C++程序_交叉编译_远程调试.md</title><link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css'><style type='text/css'>html, body {overflow-x: initial !important;}html { font-size: 14px; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; font-size: 1rem; line-height: 1.42857; color: rgb(51, 51, 51); overflow-x: hidden; background-color: rgb(255, 255, 255); }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: rgb(181, 214, 252); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; padding-bottom: 70px; white-space: pre-wrap; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
@media screen and (max-width: 500px) { 
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
.typora-export #write { margin: 0px auto; }
#write > p:first-child, #write > ul:first-child, #write > ol:first-child, #write > pre:first-child, #write > blockquote:first-child, #write > div:first-child, #write > table:first-child { margin-top: 30px; }
img { max-width: 100%; }
input, button, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
::before, ::after, * { box-sizing: border-box; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write div, #write pre { width: inherit; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6 { position: relative; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
p { -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; }
.mathjax-block { margin-top: 0px; margin-bottom: 0px; -webkit-margin-before: 0rem; -webkit-margin-after: 0rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: bold; font-style: italic; }
a { cursor: pointer; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; margin: 4px 0px 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 80px; }
.CodeMirror-gutters { border-right-width: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
pre { white-space: pre-wrap; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; position: relative !important; background: inherit; }
.md-fences .CodeMirror.CodeMirror-wrap { top: -1.6em; margin-bottom: -1.6em; }
.md-fences.mock-cm { white-space: pre-wrap; }
.show-fences-line-number .md-fences { padding-left: 0px; }
.show-fences-line-number .md-fences.mock-cm { padding-left: 40px; }
.footnotes { color: rgb(136, 136, 136); font-size: 0.9rem; padding-top: 1em; padding-bottom: 1em; }
.footnotes + .footnotes { margin-top: -1em; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; text-decoration: none; color: rgb(51, 51, 51); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; font-size: 1rem; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: normal; text-align: left; box-sizing: content-box; direction: ltr; background: transparent; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li p, li .mathjax-block { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; }
@media print { 
  html, body { height: 100%; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  h1, h2, h3, h4, h5, h6 { break-after: avoid-page; orphans: 2; }
  p { orphans: 4; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 1cm; padding-right: 1cm; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0mm; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 2.86rem; white-space: pre-wrap; display: block; background: rgb(204, 204, 204); }
p > .md-image:only-child { display: inline-block; width: 100%; text-align: center; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.mathjax-block { white-space: pre; overflow: hidden; width: 100%; }
p + .mathjax-block { margin-top: -1.143rem; }
.mathjax-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: none; box-shadow: none; }
.task-list { list-style-type: none; }
.task-list-item { position: relative; padding-left: 1em; }
.task-list-item input { position: absolute; top: 0px; left: 0px; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc::after, .md-toc-content::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: bold; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) { 
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { color: inherit; font-size: inherit; font-style: inherit; font-weight: inherit; text-decoration: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
.md-tag { opacity: 0.5; }
code { text-align: left; }
h1 .md-tag, h2 .md-tag, h3 .md-tag, h4 .md-tag, h5 .md-tag, h6 .md-tag { font-weight: initial; opacity: 0.35; }
a.md-header-anchor.md-print-anchor { border: none !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: none !important; text-decoration: initial !important; text-shadow: initial !important; background: transparent !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.mathjax-block .MathJax_SVG_Display { text-align: center; margin: 1em 0em; position: relative; text-indent: 0px; max-width: none; max-height: none; min-width: 0px; min-height: 0px; width: 100%; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: monospace; }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: normal; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }


@font-face { font-family: "Open Sans"; font-style: normal; font-weight: normal; src: local("Open Sans Regular"), url("./github/400.woff") format("woff"); }
@font-face { font-family: "Open Sans"; font-style: italic; font-weight: normal; src: local("Open Sans Italic"), url("./github/400i.woff") format("woff"); }
@font-face { font-family: "Open Sans"; font-style: normal; font-weight: bold; src: local("Open Sans Bold"), url("./github/700.woff") format("woff"); }
@font-face { font-family: "Open Sans"; font-style: italic; font-weight: bold; src: local("Open Sans Bold Italic"), url("./github/700i.woff") format("woff"); }
html { font-size: 16px; }
body { font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 20px 30px 100px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
body > :first-child { margin-top: 0px !important; }
body > :last-child { margin-bottom: 0px !important; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 4px; padding: 0px; margin: 16px 0px; border-width: 0px 0px 1px; border-style: none none solid; overflow: hidden; box-sizing: content-box; border-bottom-color: rgb(221, 221, 221); background-color: rgb(231, 231, 231); }
body > h2:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child + h2 { margin-top: 0px; padding-top: 0px; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child { margin-top: 0px; padding-top: 0px; }
a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 { margin-top: 0px; padding-top: 0px; }
h1 p, h2 p, h3 p, h4 p, h5 p, h6 p { margin-top: 0px; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left-width: 4px; border-left-style: solid; border-left-color: rgb(221, 221, 221); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; }
table tr { border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204); margin: 0px; padding: 0px; background-color: white; }
table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); }
.md-fences, code, tt { border: 1px solid rgb(221, 221, 221); border-radius: 3px; font-family: Consolas, "Liberation Mono", Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; background-color: rgb(248, 248, 248); }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding: 8px 1em 6px; }
.task-list { padding-left: 0px; }
.task-list-item { padding-left: 32px; }
.task-list-item input { top: 3px; left: 8px; }
@media screen and (min-width: 914px) { 
}
@media print { 
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; background-color: rgb(247, 247, 247); }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border: 1px solid rgb(221, 221, 221); border-radius: 3px; font-family: Consolas, "Liberation Mono", Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; color: inherit; background-color: rgb(248, 248, 248); }
.md-tag { color: inherit; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; background-color: rgb(250, 250, 250); }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.117647); }






</style>
</head>
<body class='typora-export ' >
<div  id='write'  class = 'is-node'><h1><a name='header-c1' class='md-header-anchor '></a>Widora How-To</h1><p><code>by zymxjtu</code></p><h2><a name='header-c8' class='md-header-anchor '></a>用Eclipse开发OpenWrt C/C++程序 交叉编译 远程调试</h2><h2><a name='header-c9' class='md-header-anchor '></a>1 版权</h2><p>这个 How-To 指引是基于 J.Kohler 的 OpenWrt C/C++ Devopement with Eclipse 的工作成果。 更新和增添了一些内容，以及Widora相关和独有的一些内容。</p><p>This work is licensed under the Creative Commons Attribution-ShareAlike 3.0 Unported License. To view a copy of this license, visit <a href='http://creativecommons.org/licenses/by-sa/3.0/' target='_blank' >http://creativecommons.org/licenses/by-sa/3.0/</a> or send a letter to Creative Commons, 444 Castro Street, Suite 900, Mountain View, California, 94041, USA.</p><h2><a name='header-c14' class='md-header-anchor '></a>2 版本历史</h2><table><thead><tr><th>版本</th><th>日期</th><th>作者</th><th>更改记录</th></tr></thead><tbody><tr><td>v0.1</td><td>6 Aug 2016</td><td>zymxjtu</td><td>第一版</td></tr></tbody></table><h2><a name='header-c26' class='md-header-anchor '></a>3 介绍</h2><p>使用Eclipse IDE, 我们可以有一个很方便和舒适的为OpenWrt目标设备做开发的开发环境， Eclipse提供了一套完整的开发套件。</p><p>使用交叉编译，我们可以不必受制于OpenWrt设备的资源限制；使用远程调试，可以很方便的设置断点，调试程序。</p><p>这篇文档解释了怎样使用Eclipse C/C++ IDE与OpenWrt的交叉编译工具链；怎样设置Eclipse做远程目标设备代码级别的调试和远程操控。</p><p>这里展示了怎样为OpenWrt目标设备编写代码，编译，还有调试程序，我们可以使用Eclipse为OpenWrt目标设备开发软件。</p><h2><a name='header-c35' class='md-header-anchor '></a>4 准备工作</h2><h3><a name='header-c36' class='md-header-anchor '></a>4.1 准备工作</h3><h4><a name='header-c37' class='md-header-anchor '></a>4.1.1 目标设备准备工作</h4><p>下面列出了目标设备需要的软件包:</p><ol><li>安装有DropBear 或者 OpenSSH，可以用SSH连接到设备</li><li>openssh-sftp-server</li><li>gdbserver</li><li>libstdcpp (可选，做C++开发需要)</li></ol><p>openssh-sftp-server 和 gdbserver 都可以提前编译到OpenWrt的固件里，当然如果没有预装，我们可以简单的通过下面方法安装:</p><ol><li>SSH 到 OpenWRT. (对于Widora，我们也可以通过板载串口终端，详细信息看使用指南<code>&quot;Widora_用户指南_1_开始之前&quot;</code>)</li><li>运行 <code>opkg update</code> 然后 <code>opkg install libstdcpp</code></li><li>运行 <code>opkg update</code> 然后 <code>opkg install openssh-sftp-server</code></li><li>运行 <code>opkg install gdbserver</code> 安装 gdbserver。</li></ol><p>  <img src='picture/000.001.png' alt='1.1.000' /></p><p>  <img src='picture/000.000.png' alt='1.1.000' /></p><p>对于Widora，如果Widora是连去一个路由器，然后开发电脑也是连接到同一个路由器，而不是直接连接到Widora，那么想要SSH访问Widora，我们需要更改Widora的防火墙设置。更改Widora防火墙的配置文件<code>/etc/config/firewall</code>，更改 config zone wan, option input 设置为 <code>ACCEPT</code>, 而不是默认的 <code>REJECT</code>, 保存改动之后，重启Widora:</p><p>默认:</p><p>  <img src='picture/000.002.png' alt='1.1.000' /></p><p>更改之后:</p><p>  <img src='picture/000.003.0.png' alt='1.1.000' /></p><p>然后远程SSH测试下可不可以SSH连到Widora （这里路由器为Widora分配的地址是192.168.8.180，你的环境分配的IP地址可能不同）：</p><p>  <img src='picture/000.003.1.png' alt='1.1.000' /></p><h4><a name='header-c87' class='md-header-anchor '></a>4.1.2 OpenWRT 准备工作</h4><p>准备 OpenWrt Buildroot 开发环境:</p><p>遵照“Widora-NEO开源硬件用户手册V04.pdf”。</p><p>以下连接供参考：
<a href='https://github.com/widora/openwrt_widora' target='_blank' >https://github.com/widora/openwrt_widora</a></p><p><a href='http://wiki.openwrt.org/doc/howto/buildroot.exigence' target='_blank' >http://wiki.openwrt.org/doc/howto/buildroot.exigence</a></p><p>对于Widora使用的OpenWrt Chaos Calmer版本，gdb存在一个问题，详细的信息可以参考下面链接：</p><p><a href='https://dev.openwrt.org/ticket/22360' target='_blank' >https://dev.openwrt.org/ticket/22360</a></p><p><a href='https://dev.openwrt.org/changeset/46298/trunk/toolchain/gdb' target='_blank' >https://dev.openwrt.org/changeset/46298/trunk/toolchain/gdb</a></p><p>这个问题之后在我们调试程序的时候可能会导致如下问题:</p><p>  <img src='picture/000.005.png' alt='1.1.000' /></p><p>所以对于Widora，这里需要对源码的一个地方做一点改动。
 <code>{Widora源码目录}/toolchain/gdb/Makefile</code> (如下图所示加入一行 &quot;--with-expat \&quot;):</p><p>  <img src='picture/000.004.png' alt='1.1.000' /></p><p>之后我们还需要安装依赖库&quot;libexpat1-dev&quot;:</p><pre class='md-fences mock-cm' style='display:block;position:relative'>sudo apt-get install libexpat1-dev</pre><p>在Terminal里面cd到Widora源码的根目录，然后执行 “make menuconfig”:</p><p>  <img src='picture/000.006.png' alt='1.1.000' /></p><p>然后:</p><ol><li>设置Widora的 &quot;Target System&quot;, &quot;Subtarget&quot;, &quot;Target Profile&quot;.</li><li>选择 [ * ] Build the OpenWrt SDK</li><li>选择 [ * ] Package the OpenWrt-based Toolchain</li><li>选择 [ * ] Advanced configuration options (for developers) ---&gt; Enable [ * ] Toolchain Options ---&gt; Enable [ * ] Build gdb</li><li>保存设置.</li></ol><p>  <img src='picture/000.007.png' alt='1.1.000' /></p><p>  <img src='picture/000.008.png' alt='1.1.000' /></p><p>  <img src='picture/000.009.png' alt='1.1.000' /></p><p>  <img src='picture/000.010.png' alt='1.1.000' /></p><p>  <img src='picture/000.011.png' alt='1.1.000' /></p><p>  <img src='picture/000.012.png' alt='1.1.000' /></p><p>  <img src='picture/000.013.png' alt='1.1.000' /></p><p>执行 “make toolchain/install” . 这一步的目的是准备我们之后需要用到的交叉编译工具链还有程序调试所需要的gdb.</p><p>  <img src='picture/000.014.png' alt='1.1.000' /></p><p>  <img src='picture/000.015.png' alt='1.1.000' /></p><h4><a name='header-c158' class='md-header-anchor '></a>4.1.3 Eclipse 准备工作</h4><p>下载你喜欢的 Eclipse IDE for C/C++ Developers 版本.</p><p>对于这篇指引，我们用的是 Eclipse IDE for C/C++ Developers Eclipse Luna SR2 (4.4.2) Linux.</p><p><a href='http://www.eclipse.org/downloads/packages/release/luna/sr2' target='_blank' >http://www.eclipse.org/downloads/packages/release/luna/sr2</a></p><p>选择你偏爱的版本和平台 (32位 / 64 位).</p><p>解压缩，把Eclipse放到你偏爱的目录，执行Eclipse，选择你偏爱的workspace位置。<strong>注意：Eclipse运行需要Java Runtime</strong>。</p><p>  <img src='picture/000.016.png' alt='1.1.000' /></p><p>  <img src='picture/000.017.png' alt='1.1.000' /></p><p>  <img src='picture/000.018.png' alt='1.1.000' /></p><p>  <img src='picture/000.019.png' alt='1.1.000' /></p><p>我们可能需要安装额外的eclipse软件包：<code>Help → Install new Software → All Available Sites</code>. 选择 <strong>“Mobile and Device Development”</strong> 下的 <strong>“C/C++ GCC Cross Compiler Support”</strong> 还有 <strong>“Remote System Explorer End-User Runtime”</strong>.</p><p>如果你使用的是 Eclipse IDE for C/C++ Developers, 很可能这两个软件包已经默认安装了。 如果你像查看这两个软件包，去掉点选 <strong>“Hide items that are already installed”</strong>.</p><p>  <img src='picture/000.020.png' alt='1.1.000' /></p><p>  <img src='picture/000.021.png' alt='1.1.000' /></p><h2><a name='header-c186' class='md-header-anchor '></a>5 工程配置</h2><h3><a name='header-c187' class='md-header-anchor '></a>5.1 Eclipse 交叉编译工程的配置</h3><h4><a name='header-c188' class='md-header-anchor '></a>5.1.1 配置 eclipse</h4><p>新建一个工程: <code>File → New C++ Project (resp. C project)</code>:</p><p>  <img src='picture/000.022.png' alt='1.1.000' /></p><p>  <img src='picture/000.023.png' alt='1.1.000' /></p><p>下面的设置是和你的目标设备还有你的OpenWrt开发环境相关的，你需要查看你开发环境独特的设置。</p><p>这里我们需要设置交叉工具链的路径还有prefix。</p><p>进入Widora源码的根目录，执行 <code>find ./staging_dir -path &quot;./staging_dir/toolchain*&quot; -name *openwrt-linux</code></p><p>  <img src='picture/000.024.png' alt='1.1.000' /></p><p>当撰写这篇指引时用的开发环境返回的结果如下：</p><p><code>./staging_dir/toolchain-mipsel_24kec+dsp_gcc-4.8-linaro_uClibc-0.9.33.2/mipsel-openwrt-linux</code></p><p>因此 “Cross compiler prefix” 我们填写 <code>mipsel-openwrt-linux-</code>.</p><p>然后需要注意的是 “Cross compiler path” 需要填写的是<strong>绝对路径</strong>:</p><p><code>[你Widora的源码目录]/staging_dir/toolchain-mipsel_24kec+dsp_gcc-4.8-linaro_uClibc-0.9.33.2/</code></p><p><strong>不要忘了你的开发环境应该会和写这篇指引所用的环境不同，不能闭着眼睛复制黏贴!</strong></p><p>填入你的设置然后Finish按钮结束。</p><p>  <img src='picture/000.025.png' alt='1.1.000' /></p><h4><a name='header-c219' class='md-header-anchor '></a>5.1.2 Eclipse 工程设置</h4><p>在这里，我们会创建一个简单的Hello World程序做示范，展示如何设置eclipse对远程目标设备进行代码级别的调试和远程访问。</p><p>为源码创建一个src文件夹。</p><p><code>File → New Source Folder (src)</code></p><p><code>File → New Source File (src/HelloWidora.cpp)</code></p><pre class='md-fences mock-cm' style='display:block;position:relative'>#include &lt;iostream&gt;
using namespace std;
int main()
{
	int i = 0;
	for (i=0; i&lt;10; i++)
	{
		cout &lt;&lt; &quot;Hello OpenWrt&quot; &lt;&lt; endl;
	}
	return 0;
}</pre><p>  <img src='picture/000.026.png' alt='1.1.000' /></p><p>如果一切配置正确的话，现在你应该可以交叉编译代码了 <code>Project-Build all</code> 。</p><p>生成的程序肯定是不能在开发电脑上直接运行的，因为我们是用交叉工具链编译的可以跑在Widora上的MIPS架构的二进制可执行文件。</p><p>  <img src='picture/000.027.png' alt='1.1.000' /></p><h5><a name='header-c237' class='md-header-anchor '></a>5.1.2.1 远程目标设备的配置（Widora）</h5><p>如果你的程序编译成功，你需要在你的目标设备上执行你所写的程序，这个时候，eclipse提供的远程访问和远程调试功能就非常有用：</p><p>选择 <code>Window → Show View → Other… → Remote Systems</code></p><p>  <img src='picture/000.028.png' alt='1.1.000' /></p><p>创建一个新连接:</p><p>  <img src='picture/000.029.png' alt='1.1.000' /></p><p>选择 Linux 然后下一步 “Next &gt;”:</p><p>  <img src='picture/000.030.png' alt='1.1.000' /></p><p>现在填写目标设备的IP地址，然后下一步 “Next &gt;”.</p><p>  <img src='picture/000.031.png' alt='1.1.000' /></p><p>选择 “ssh.files” 然后下一步 “Next &gt;”.</p><p>  <img src='picture/000.032.png' alt='1.1.000' /></p><p>选择 “processes.shell.linux” 然后下一步 “Next &gt;”.</p><p>  <img src='picture/000.033.png' alt='1.1.000' /></p><p>选择 “ssh.shells” 然后下一步 “Next &gt;”. 然后 “Finish”.</p><p>  <img src='picture/000.034.png' alt='1.1.000' /></p><p>  <img src='picture/000.035.png' alt='1.1.000' /></p><p>你的 Eclipse IDE 看来是这个样子:</p><p>  <img src='picture/000.036.png' alt='1.1.000' /></p><h5><a name='header-c274' class='md-header-anchor '></a>5.1.2.2 浏览你的目标设备</h5><p>  <img src='picture/000.037.0.png' alt='1.1.000' /></p><p>输入你目标设备的用户名和密码:</p><p>  <img src='picture/000.037.png' alt='1.1.000' /></p><p>第一次, Eclipse 会让你设置安全存储的主密码, 设置你的主密码然后继续:</p><p>  <img src='picture/000.038.png' alt='1.1.000' /></p><p>  <img src='picture/000.039.png' alt='1.1.000' /></p><p>连接成功之后，你可以很方便的把文件拖曳到你的目标设备上(drag n&#39; drop)，你甚至可以控制目标设备的进程(processes)，比如你可以kill一个目标设备上的进程。</p><p>  <img src='picture/000.040.png' alt='1.1.000' /></p><p>你也可以在eclipse里面打开一个SSH Terminal，拷贝执行文件：</p><p>  <img src='picture/000.041.png' alt='1.1.000' /></p><p>  <img src='picture/000.042.png' alt='1.1.000' /></p><h5><a name='header-c297' class='md-header-anchor '></a>5.1.2.3 远程调试gdb Debugger的配置</h5><p>要想做远程调试，首先我们需要创建一个调试配置:</p><p>左键点击“bug”图标旁边的箭头，选择“Debug Configurations”。</p><p>  <img src='picture/000.043.png' alt='1.1.000' /></p><p>然后创建一个新的 C/C++ Remote Application Debug Configuration:</p><p>  <img src='picture/000.044.png' alt='1.1.000' /></p><ul><li><p>在 “Main” 选项页.</p></li><li><p>对于 “Connection”，选择之前创建的连接 (看“远程目标设备的配置（Widora）”).</p></li><li><p>不要忘了“Remote Absolute File Path for C/C++ Application”，这里设置的是你想要把程序放到Widora上的绝对路径。</p><p><img src='picture/000.045.png' alt='1.1.000' /></p></li></ul><p>然后切换到 “Debugger” 选项卡设置开发主机的gdb文件.</p><p>在开发主机上，我们不能直接用默认的/usr/bin/gdb （Ubuntu默认），我们需要指向我们之前编译的gdb，还有工具命令的前缀也需要设置正确。</p><p>在Widora源码根目录执行: <code>find ./build_dir -executable -type f -name gdb |grep toolchain</code>。</p><p>当撰写这篇指引时用的开发环境返回的结果如下：
<code>./build_dir/toolchain-mipsel_24kec+dsp_gcc-4.8-linaro_uClibc-0.9.33.2/gdb-linaro-7.6-2013.05/gdb/gdb</code></p><p>  <img src='picture/000.046.png' alt='1.1.000' /></p><p>在 “GDB debugger”, 我们需要填写的是<strong>绝对路径</strong>，对于写这篇指引时用到的开发环境是:</p><p><code>/home/dev101/Desktop/Prj/openwrt_widora/build_dir/toolchain-mipsel_24kec+dsp_gcc-4.8-linaro_uClibc-0.9.33.2/gdb-linaro-7.6-2013.05/gdb/gdb</code></p><p><strong>不要忘了你的开发环境应该会和写这篇指引所用的环境不同，不能闭着眼睛复制黏贴!</strong></p><p>其他的设置不需要改动，现在你可以按“Debug”按钮开始调试。</p><p>  <img src='picture/000.047.png' alt='1.1.000' /></p><h5><a name='header-c341' class='md-header-anchor '></a>5.1.2.4 远程调试示例</h5><p>  <img src='picture/000.048.png' alt='1.1.000' /></p><p>当你选择开始我们之前配置好的远程调试之后，eclipse的调试视图会打开：</p><p>  <img src='picture/000.049.png' alt='1.1.000' /></p><p>  <img src='picture/000.050.png' alt='1.1.000' /></p><p>上面的红色警告可以忽略，原因是当编译Widora现在所运行的这个固件的是后我们没有选择 <code>“Advanced configuration options (for developers)-&gt;Build Options-&gt;Debugging”</code>。</p><h2><a name='header-c353' class='md-header-anchor '></a>6 总结</h2><p>恭喜，你现在已经有一个完整的OpenWrt的IDE开发环境了！你可以在Eclipse IDE里面开发你的OpenWrt C/C++ 程序，交叉编译它，设置断点，远程调试。</p><p>  <img src='picture/000.051.png' alt='1.1.000' /></p><p>  <img src='picture/000.052.png' alt='1.1.000' /></p></div>
</body>
</html>